# Cyberinfrastructure Knowledge Network (CKN) Stream Processors

This repository hosts the CKN Stream Processors, a core component of the Cyberinfrastructure Knowledge Network (CKN) that powers real-time data aggregation and alerting for edge environments. These processors are implemented using Kafka Streams, enabling efficient handling of high-throughput event data generated by edge devices.

The primary functionalities of the CKN Stream Processors include:

- **Event Aggregation:** Using Kafka Streams with tumbling windows, the processors aggregate events generated by the CKN Daemon. This aggregation captures a high-level view of activity over specified time windows, supporting efficient analysis and decision-making.

- **Alerting Mechanism:** An integrated alert component continuously monitors streaming edge events. It automatically triggers alerts if model accuracy falls below a configurable threshold, helping maintain optimal AI performance at the edge.

This repository includes:

- **Docker files** for compiling and running the stream processors.
- **Configuration files** for Kafka Streams and tumbling window settings.
- **Alert configurations** to set and adjust accuracy thresholds.

For full deployment and integration, these stream processors can be linked with the main [CKN framework](https://github.com/Data-to-Insight-Center/cyberinfrastructure-knowledge-network)

The CKN Stream Processors provide a vital data aggregation and monitoring layer within CKN, helping ensure the systemâ€™s responsiveness and adaptability in dynamic edge environments.


## Getting Started

### Quickstart

1. **Set the Message Broker environment variable**

    If a message broker is unavailable, clone the [CKN repository](https://github.com/Data-to-Insight-Center/cyberinfrastructure-knowledge-network) and run `make up`.

    ```shell
    export CKN_BROKERS="<CKN_BROKER_ADDRESS>"
    ```

2. **Compile the JAR File**
    Ensure the JAR files are in the `./target` directory. If not, compile them by running:
    ```shell
    mvn clean package
    ```

3. **Build and Run the Docker Container**
    ```shell
    docker build -f Dockerfile.RawAlert -t ckn-processor-oracle-alert .
    docker run --name ckn-alerter ckn-processor-oracle-alert
    ```

---

## Building from Source

### Prerequisites

- **Maven 3**: For building and managing dependencies.
- **JDK**: Ensure the Java Development Kit is installed.

### Compile the JAR File

1. From the project root, compile the code by running:
    ```shell
    mvn clean package
    ```

2. Navigate to the `/target` directory to find the generated JAR files.

### Running the Processors

After building, you can execute the processors directly:

- **OracleAggregationProcessor**:
    ```shell
    java -cp ckn-stream-processors-0.1-SNAPSHOT.jar edu.d2i.ckn.OracleAggregationProcessor
    ```

- **OracleAccAlertProcessor**:
    ```shell
    java -cp ckn-stream-processors-0.1-SNAPSHOT.jar edu.d2i.ckn.OracleAccAlertProcessor
    ```

---

## Testing

For instructions, refer `plugins/oracle_ckn_daemon/tests/README.md` on the [CKN repository](https://github.com/Data-to-Insight-Center/cyberinfrastructure-knowledge-network).

---

## License

The Cyberinfrastructure Knowledge Network (CKN) is developed by the Indiana University Board of Trustees and distributed under the BSD 3-Clause License. See `LICENSE.txt` for more details.

## Reference

S. Withana and B. Plale, "CKN: An Edge AI Distributed Framework," *2023 IEEE 19th International Conference on e-Science (e-Science)*, Limassol, Cyprus, 2023, pp. 1-10, doi: 10.1109/e-Science58273.2023.10254827.
